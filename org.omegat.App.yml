app-id: org.omegat.App
runtime: org.freedesktop.Platform
runtime-version: '19.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.openjdk11
command: OmegaT

finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  - --socket=pulseaudio
  - --share=network
  - --device=dri
  - --filesystem=home

  - --env=PATH=/usr/bin:/app/bin:/app/jre/bin
  - --env=JAVA_HOME=/app/jre
  - --env=JAVA=/app/jre/bin/java

build-options:
    env:
        JAVA_HOME: /usr/lib/sdk/openjdk11/
modules:
  - name: openjdk
    buildsystem: simple
    build-commands:
      - /usr/lib/sdk/openjdk11/install.sh

  - name: omegat
    no-autogen: true
    sources:
      # fetch source code for getting some resources
      - type: git
        url: git://git.code.sf.net/p/omegat/code
        tag: v5.2.0

      # fetch binary for packing without compiling
      - type: archive
        url: http://sourceforge.net/projects/omegat/files/OmegaT%20-%20Latest/OmegaT%205.2.0/OmegaT_5.2.0_Beta_Without_JRE.zip/
        sha256: fbaa6efad8767b588ceaa05ae1752bba278f994cfba6efa8e8243f86ee138bc6
        strip-components: 0

      # Desktop file.
      - type: file
        path: org.omegat.App.desktop

      # AppData.
      - type: file
        path: org.omegat.App.metainfo.xml

      # mime data.
      - type: file
        path: org.omegat.App.mime.xml

    buildsystem: simple
    build-commands: 
      - mkdir -p /app/OmegaT /app/bin
      - cp -a OmegaT_5.2.0_Beta_Without_JRE/* /app/OmegaT
      - ln -s /app/OmegaT/OmegaT /app/bin
      - install -Dm644 org.omegat.App.desktop /app/share/applications/org.omegat.App.desktop
      - install -Dm644 images/OmegaT.svg /app/share/icons/hicolor/scalable/apps/org.omegat.App.svg
      - install -Dm644 org.omegat.App.metainfo.xml /app/share/metainfo/org.omegat.App.metainfo.xml
      - install -Dm644 org.omegat.App.mime.xml /app/share/mime/packages/org.omegat.App.xml

    post-install:
      - update-mime-database /app/share/mime
